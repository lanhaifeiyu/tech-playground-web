webpackJsonp([5],{DH2y:function(e,t,a){"use strict";var s,n=a("Xxa5"),r=a.n(n),o=a("exGp"),i=a.n(o),c=a("Dd8w"),l=a.n(c),d=a("NYxO"),u=(s=0,function(e,t){clearTimeout(s),s=setTimeout(e,t)}),h={name:"userList",data:function(){return{userDept:sessionStorage.getItem("deptId"),searched:"",userOptions:[],deptOptions:[],loading:!1,deptSearch:!1}},computed:l()({users:{get:function(){return this.$store.state.users},set:function(e){this.$store.commit("loadUsers",e)}},type:{get:function(){return this.$store.state.userSearchType},set:function(e){this.$store.commit("changeUserSearch",e)}},back:function(){return!this.users[0]||this.userDept!==this.users[0].id},selectedUserNode:{get:function(){return this.$store.state.selectedUserNode},set:function(e){this.$store.commit("changeUserNode",e)}}},Object(d.b)(["treeHeight","selectedUser","multiple","selectedUsers","color"]),Object(d.d)(["disableNodes"])),watch:{type:function(e){this.deptSearch="name"===e||"shortName"===e,this.deptOptions=[],this.userOptions=[]},multiple:function(e){e&&("name"===this.type&&"shortName"===this.type||(this.type="name"))}},methods:{hide:function(){this.$store.commit("showChange",!1)},selectUser:function(e){this.deptSearch?this.initialData(e.value,!this.multiple):(this.selectedUserNode[0]&&(this.selectedUserNode[0].selected=!1),this.selectedUserNode=[{id:e.value,type:"user",title:e.label.split("(")[0]}])},search:function(e){var t=this;u(function(e){""!==e&&(t.deptSearch?t.searchDept(e):t.searchUser(e))},500)},selectedNodes:function(e){this.selectedUserNode=e,this.searched="",this.multiple||this.$store.dispatch("updateName")},checkNodes:function(e){var t=this;return i()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.alternate(e);case 2:t.$store.commit("changeUserNodes",e);case 3:case"end":return a.stop()}},a,t)}))()},alternate:function(e){var t=this;return i()(r.a.mark(function a(){var s,n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.length>=2){for(s=e[0].type,n=1;n<e.length&&e[n].type===s;)n+=1;n<e.length&&(1===n?e[2]&&e[2].type===e[1].type?(e[0].checked=!1,e.splice(0,1)):(e[1].checked=!1,e.splice(1,1)):(e[n].checked=!1,e.splice(n,1)),t.$Message.warning("不能同时选择部门和用户"))}case 1:case"end":return a.stop()}},a,t)}))()},searchDept:function(e){var t=this;this.loading=!0;var a={};a[this.type]=e,this.$axios({method:"get",headers:{Authorization:"Bearer "+sessionStorage.getItem("token")},url:this.$host+"/dept/like",params:a}).then(function(e){console.log(e),t.deptOptions=e.data.data,t.loading=!1}).catch(function(e){console.log(e),t.loading=!1})},searchUser:function(e){var t=this;this.loading=!0;var a={};a[this.type]=e,this.$axios({method:"get",headers:{Authorization:"Bearer "+sessionStorage.getItem("token")},url:this.$host+"/user/like",params:a}).then(function(e){console.log(e),t.userOptions=e.data.data,t.loading=!1}).catch(function(e){console.log(e),t.loading=!1})},loadTreeData:function(e,t){var a=this;return i()(r.a.mark(function s(){var n,o;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=[],o=[],s.next=4,a.loadUser(e,n);case 4:return s.next=6,a.loadDept(e,o);case 6:t(o.concat(n));case 7:case"end":return s.stop()}},s,a)}))()},loadDept:function(e,t){var a=this;return i()(r.a.mark(function s(){return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.$axios({method:"get",headers:{Authorization:"Bearer "+sessionStorage.getItem("token")},url:a.$host+"/dept/base",params:{dept_id:e.id,dept_chain:2,count:1e3,page:1}}).then(function(e){if(console.log(e),e.data.success)for(var s=e.data.data.length,n=0;n<s;n++){var r=a.isDisabled(e.data.data[n].dept_id),o={title:r?e.data.data[n].dept_name+"*":e.data.data[n].dept_name,loading:!1,id:e.data.data[n].dept_id,children:[],type:"dept",disabled:r};t.push(o)}else a.$Message.warning({content:"部门加载失败，请稍后再试"});return t}).catch(function(e){return console.log(e),t});case 2:case"end":return s.stop()}},s,a)}))()},loadUser:function(e,t){var a=this;return i()(r.a.mark(function s(){return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!a.isDisabled(e.id)){s.next=2;break}return s.abrupt("return",t);case 2:return s.next=4,a.$axios({method:"get",headers:{Authorization:"Bearer "+sessionStorage.getItem("token")},url:a.$host+"/user/base",params:{dept_id:e.id,dept_chain:0,count:1e3,page:1}}).then(function(e){if(console.log(e),e.data.success)for(var s=0;s<e.data.data.length;s++){var n={title:e.data.data[s].name,type:"user",id:e.data.data[s].uid};t.push(n)}else a.$Message.warning({content:"加载用户出错，请稍后再试"});return t}).catch(function(e){return t});case 4:case"end":return s.stop()}},s,a)}))()},initialData:function(e,t){var a=this;return i()(r.a.mark(function s(){return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a.users=[],s.next=3,a.$axios({method:"get",headers:{Authorization:"Bearer "+sessionStorage.getItem("token")},url:a.$host+"/dept/base",params:{dept_id:e,dept_chain:0,count:1,page:1}}).then(function(e){if(console.log(e),e.data.success){var s=a.isDisabled(e.data.data[0].dept_id),n={title:s?e.data.data[0].dept_name+"*":e.data.data[0].dept_name,loading:!1,type:"dept",id:e.data.data[0].dept_id,selected:t,children:[],disabled:s};a.users=[n],a.selectedUserNode=t?a.users:[],a.searched="",a.multiple||a.$store.dispatch("updateName")}else a.$Message.warning({content:"服务器繁忙，请稍后再试"})}).catch(function(e){console.log(e)});case 3:case"end":return s.stop()}},s,a)}))()},isDisabled:function(e){for(var t=0;t<this.disableNodes.length;t++)if(e===this.disableNodes[t].id)return!0;return!1}},mounted:function(){this.$store.dispatch("checkForDisable"),0===this.users.length&&this.initialData(this.userDept,!1),this.type||(this.multiple?this.type="name":this.type="displayName")}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",{style:{width:"90%",minWidth:"200px",maxWidth:"400px",background:e.color.card},attrs:{bordered:!1}},[a("p",{style:{color:e.color.text},attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"md-list"}}),e._v("\n      用户表\n    ")],1),e._v(" "),a("a",{directives:[{name:"show",rawName:"v-show",value:e.back,expression:"back"}],attrs:{slot:"extra",href:"#"},on:{click:function(t){t.preventDefault(),e.initialData(e.userDept,!1),e.searched=""}},slot:"extra"},[a("Icon",{attrs:{type:"ios-loop-strong"}}),e._v("\n      重置\n    ")],1),e._v(" "),a("a",{attrs:{slot:"extra",href:"#"},on:{click:function(t){return t.preventDefault(),e.hide(t)}},slot:"extra"},[a("Icon",{attrs:{type:"ios-loop-strong"}}),e._v("\n      隐藏\n    ")],1),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!e.multiple,expression:"!multiple"}],style:{margin:"0px 0px 13px 0px",color:e.color.highlight}},[e._v("当前选择："+e._s(e.selectedUser))]),e._v(" "),a("Row",{staticStyle:{margin:"10px 0"}},[a("Select",{staticStyle:{width:"auto"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("Option",{attrs:{value:"name"}},[e._v("部门全称")]),e._v(" "),a("Option",{attrs:{value:"shortName"}},[e._v("部门简称")]),e._v(" "),a("Option",{attrs:{value:"displayName",disabled:e.multiple}},[e._v("姓名")]),e._v(" "),a("Option",{attrs:{value:"phone",disabled:e.multiple}},[e._v("电话")]),e._v(" "),a("Option",{attrs:{value:"corpI",disabled:e.multiple}},[e._v("组织ID")])],1),e._v(" "),a("Select",{style:{width:"55%"},attrs:{filterable:"",remote:"","remote-method":e.search,placeholder:"输入要搜索的...",loading:e.loading,clearable:""},on:{"on-select":e.selectUser},model:{value:e.searched,callback:function(t){e.searched=t},expression:"searched"}},[e._l(e.deptOptions,function(t,s){return e.deptSearch?a("Option",{key:s,style:{maxWidth:"200px"},attrs:{value:t.uniqueId}},[e._v("\n        "+e._s(t.name)+"\n        ")]):e._e()}),e._v(" "),e._l(e.userOptions,function(t,s){return e.deptSearch?e._e():a("Option",{key:s,style:{maxWidth:"200px"},attrs:{value:t.id}},[e._v("\n        "+e._s(t.displayName)+"("+e._s(t.id)+")\n        ")])})],2)],1),e._v(" "),a("div",{staticClass:"tree"},[a("Tree",{ref:"tree4",style:{maxHeight:e.treeHeight+"px",color:e.color.text},attrs:{data:e.users,"load-data":e.loadTreeData,"show-checkbox":e.multiple,"check-directly":"","check-strictly":""},on:{"on-check-change":e.checkNodes,"on-select-change":e.selectedNodes}})],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(h,p,!1,function(e){a("smwF")},"data-v-0aed0534",null);t.a=m.exports},K7fn:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),n=a.n(s),r=a("NYxO"),o=a("dXKt"),i=a("FVPG"),c=a("d+Gc"),l=a("hNNa"),d=a("FZWW"),u=a("SS3Z"),h=a("ZuUQ"),p=a("B1va"),m=a("DH2y"),f={components:{MessageModal:a("J9bj").a,UserList:m.a,PageComp:p.a,Orientation:h.a,MyMenu:u.a,FullButtons:d.a,TableCheckBox:l.a,HeadComp:c.a,SearchBoxes:i.a,DeptList:o.a},data:function(){return{all:"",pageSize:10,currentPage:1,tableLoading:!1,pageSizes:[5,10,20,50,100,200],test:[]}},mounted:function(){this.$store.commit("changeName","用户统计表格");0===this.userTotal&&this.$refs.search.newQuery()},computed:n()({isCollapsed:{get:function(){return this.$store.state.isCollapsed},set:function(e){this.$store.commit("menuCollapsed",e)}}},Object(r.d)(["depShow","userData","fullscreen","searchShow","websocket","loading"]),Object(r.b)(["display","userCol","contentHeight","userStart","userEnd","userTotal","userPdfTitle","color"])),methods:{graphGo:function(){this.$router.push("graph")},toGetPdf:function(){window.scrollTo(0,0),this.getPdf(this.userPdfTitle)},exportData:function(){this.$refs.search.exportExcel()}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Content",{style:{padding:"10px 20px 10px",minHeight:e.contentHeight+"px",background:e.color.content}},[a("FullButtons"),e._v(" "),a("Row",[a("Col",{directives:[{name:"show",rawName:"v-show",value:e.depShow,expression:"depShow"}],staticClass:"noPrint",attrs:{lg:7}},[a("UserList")],1),e._v(" "),a("Col",{attrs:{lg:e.display,id:"mainPage"}},[a("SearchBoxes",{directives:[{name:"show",rawName:"v-show",value:!e.fullscreen||e.searchShow,expression:"!fullscreen||searchShow"}],ref:"search"}),e._v(" "),a("Row",[a("Col",{attrs:{lg:24}},[a("div",{attrs:{id:"pdfDom"}},[a("Table",{ref:"table",attrs:{id:"print",loading:e.loading,columns:e.userCol,data:e.userData.slice(e.userStart,e.userEnd)}})],1)])],1),e._v(" "),a("PageComp"),e._v(" "),a("ButtonGroup",{staticClass:"noPrint",staticStyle:{float:"right"},attrs:{shape:"circle"}},[a("Button",{staticStyle:{"margin-top":"5px","box-shadow":"none"},attrs:{size:"small",type:"primary"},on:{click:e.exportData}},[e._v("导出")]),e._v(" "),a("Button",{staticStyle:{"margin-top":"5px","box-shadow":"none"},attrs:{size:"small"},on:{click:e.toGetPdf}},[e._v("打印")])],1)],1)],1)],1)},staticRenderFns:[]},v=a("VU/8")(f,g,!1,null,null,null);t.default=v.exports},smwF:function(e,t){}});